#!/usr/bin/env perl
use warnings;
use strict;
use LWP::Simple;

my $duration = '50:00';
$duration = $ARGV[0] if defined($ARGV[0]);

# http://pyther.net/wp/2010/08/listen-to-iheartradio-without-flash/
my $station = 'KFI-AM';
my $url = "http://p2.${station}.ccomrcdn.com/player/player_dispatcher.html?section=radio&action=listen_live";
my $page = get $url;
open(my $out, '>', '/tmp/kfi') or die;
print $out $page;
close $out;
$page =~ m/primary_location=\"(.*?)\"/;
print "=>$1<=\n";
my $command = "mplayer -novideo -endpos $duration '" . $1 . "'";
print "=> $command\n";
system $command;

__END__


mplayer -novideo 'rtmp://cp19771.live.edgefcs.net/live/Los_CA_KFI-AM_OR@s7652?auth=daEcYaldKa8bZc_bXatcddobca5dca8cXaT-bpxHD.-4q-LLYY6_1omFDov1LCqmzsyp&amp;aifp=1234&amp;CHANNELID=177&amp;CPROG=_&amp;MARKET=LOSANGELES-CA&amp;REQUESTOR=KFI-AM&amp;SERVER_NAME=p2.kfi-am.ccomrcdn.com&amp;SITE_ID=616&amp;STATION_ID=KFI-AM&amp;MNM=1&amp;TYPEOFPLAY=0" backup_location=""'    

    

<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<PlayerContent><ListenLiveInitialize xmlns=""><StreamInfo xmlns=""><stream xmlns="" id="177" primary_location="rtmp://cp19771.live.edgefcs.net/live/Los_CA_KFI-AM_OR@s7652?auth=daEa9bqaddsdHa_aOdYcKcUcEcmdOdccga4-bpAExa-4q-MM3V3_9qoDDnm4CCtlBtwr&amp;aifp=1234&amp;CHANNELID=177&amp;CPROG=_&amp;MARKET=LOSANGELES-CA&amp;REQUESTOR=KFI-AM&amp;SERVER_NAME=p2.kfi-am.ccomrcdn.com&amp;SITE_ID=616&amp;STATION_ID=KFI-AM&amp;MNM=1&amp;TYPEOFPLAY=0" backup_location=""></stream></StreamInfo><PodcastItems xmlns="" url="http://www.kfiam640.com/cc-common/podcast/single_podcast.html?podcast=BillHandel.xml" feed_name="BillHandel.xml"><item xmlns="" mediaId="21923476" title="Sheriff's Dept. 8-830A (3/20)" poster_image="http://www.kfiam640.com/cc-common/flash_player/images/default_audio_image_lg.jpg" url="rtmp://cp84633.edgefcs.net/ondemand/station_content/616/Handel0320128830A_1332261787_30866.mp3" type="audio"></item><item xmlns="" mediaId="21923456" title="Trayvon Martin 7AM (3/20)" poster_image="http://www.kfiam640.com/cc-common/flash_player/images/default_audio_image_lg.jpg" url="rtmp://cp84633.edgefcs.net/ondemand/station_content/616/Handel0320127A_1332261563_14544.mp3" type="audio"></item><item xmlns="" mediaId="21923390" title="Handel on the News (3/20)" poster_image="http://www.kfiam640.com/cc-common/flash_player/images/default_audio_image_lg.jpg" url="rtmp://cp84633.edgefcs.net/ondemand/station_content/616/HOTN032012_1332260844_23017.mp3" type="audio"></item><item xmlns="" mediaId="21923282" title="Max Thrax 5AM (3/20)" poster_image="http://www.kfiam640.com/cc-common/flash_player/images/default_audio_image_lg.jpg" url="rtmp://cp84633.edgefcs.net/ondemand/station_content/616/Handel0320125A_1332259930_23943.mp3" type="audio"></item><item xmlns="" mediaId="21919342" title="Afghan Massacre 8-830A (3/19)" poster_image="http://www.kfiam640.com/cc-common/flash_player/images/default_audio_image_lg.jpg" url="rtmp://cp84633.edgefcs.net/ondemand/station_content/616/Handel0319128830A_1332176651_6100.mp3" type="audio"></item></PodcastItems><Schedule xmlns=""><RJ xmlns="" name="Rush Limbaugh" thumb="http://www.kfiam640.com/pages/rotator_images/rush_56sq.jpg" blog_url="http://www.rushlimbaugh.com/" start_time="9:00am" end_time="12:00pm"></RJ><RJ xmlns="" name="Bill Carroll" thumb="http://www.kfiam640.com/cc-common/mlib/8169/04/8169_1239037922.jpg" blog_url="http://www.kfiam640.com/pages/BillCarroll.html" start_time="12:00pm" end_time="3:00pm"></RJ><RJ xmlns="" name="John and Ken" thumb="http://www.kfiam640.com/pages/rotator_images/jk_56sq.jpg" blog_url="http://www.kfiam640.com/pages/jk2010.html" start_time="3:00pm" end_time="7:00pm"></RJ></Schedule><OnAir xmlns=""><RJ xmlns="" name="Bill Handel" thumb="http://www.kfiam640.com/pages/rotator_images/handel_56sq.jpg" blog_url="http://www.kfiam640.com/pages/Handel2.html" start_time="5:00am" end_time="9:00am"></RJ></OnAir><promo xmlns="" image="http://www.kfiam640.com/cc-common/promographics/Newstalk_Graphics/FLASHPLAYER/ExperiencePolitics_DL3.jpg" link_uri="http://www.kfiam640.com/mediaplayer/?stream_id=4353&amp;channel_title=White%20House%20Brief" target="internal"></promo><BottomPanel xmlns=""><StationContent xmlns=""></StationContent><WhatsHot xmlns=""></WhatsHot><MoreStations xmlns=""><station xmlns="" stream_id="4505" name="SIDECHANNEL-FL" domain="kfi-am" init="0" title="Eagles Radio" station_tagline="Eagles Radio" station_url="" genre="" city="National" state="" latitude="" longitude="" image="http://www.kfiam640.com/cc-common/mlib/8169/07/8169_1247681035.jpg" logo="http://www.kfiam640.com/cc-common/mlib/8169/07/8169_1247681035.jpg"><description xmlns="">Their music, stories and favorite bands</description></station><station xmlns="" stream_id="4242" name="SIDECHANNEL-FL" domain="kfi-am" init="0" title="Smooth Jazz" station_tagline="Smooth Jazz" station_url="" genre="Other" city="National" state="" latitude="" longitude="" image="http://www.kfiam640.com/cc-common/mlib/8169/03/8169_1238384533.jpg" logo="http://www.kfiam640.com/cc-common/mlib/8169/03/8169_1238384533.jpg"><description xmlns="">The Smoothest Place on the Planet</description></station><station xmlns="" stream_id="4711" name="SIDECHANNEL-FL" domain="kfi-am" init="0" title="White House Brief" station_tagline="White House Brief" station_url="" genre="" city="National" state="" latitude="" longitude="" image="http://www.kfiam640.com/cc-common/mlib/8169/07/8169_1311366424.jpg" logo="http://www.kfiam640.com/cc-common/mlib/8169/07/8169_1311366424.jpg"><description xmlns="">A New Way To Experience Politics</description></station><station xmlns="" stream_id="4439" name="SIDECHANNEL-FL" domain="kfi-am" init="0" title="Cool Oldies" station_tagline="Cool Oldies" station_url="" genre="" city="National" state="" latitude="" longitude="" image="http://www.kfiam640.com/cc-common/mlib/8169/08/8169_1249576326.jpg" logo="http://www.kfiam640.com/cc-common/mlib/8169/08/8169_1249576326.jpg"><description xmlns="">Sing Along Songs of 60's &amp; 70's!</description></station><station xmlns="" stream_id="4719" name="SIDECHANNEL-FL" domain="kfi-am" init="0" title="Slow Jams" station_tagline="Slow Jams" station_url="" genre="R&amp;B" city="National" state="" latitude="" longitude="" image="http://www.kfiam640.com/cc-common/mlib/8169/05/8169_1242835954.jpg" logo="http://www.kfiam640.com/cc-common/mlib/8169/05/8169_1242835954.jpg"><description xmlns="">A smooth blend of classic and new R&amp;B love songs</description></station><station xmlns="" stream_id="4418" name="SIDECHANNEL-FL" domain="kfi-am" init="0" title="Country Road" station_tagline="Country Road" station_url="" genre="Country" city="National" state="" latitude="" longitude="" image="http://www.kfiam640.com/cc-common/mlib/8169/05/8169_1243359917.jpg" logo="http://www.kfiam640.com/cc-common/mlib/8169/05/8169_1243359917.jpg"><description xmlns="">Real Songs About Real Life</description></station><station xmlns="" stream_id="4455" name="SIDECHANNEL-FL" domain="kfi-am" init="0" title="Big Classic Hits" station_tagline="Big Classic Hits" station_url="" genre="" city="National" state="" latitude="" longitude="" image="http://www.kfiam640.com/cc-common/mlib/8169/06/8169_1244755101.jpg" logo="http://www.kfiam640.com/cc-common/mlib/8169/06/8169_1244755101.jpg"><description xmlns="">Feel Good Songs of the 70's &amp; 80's!</description></station><station xmlns="" stream_id="4435" name="SIDECHANNEL-FL" domain="kfi-am" init="0" title="Foggy Mountain" station_tagline="Foggy Mountain" station_url="" genre="" city="National" state="" latitude="" longitude="" image="http://www.kfiam640.com/cc-common/mlib/8169/06/8169_1244754206.jpg" logo="http://www.kfiam640.com/cc-common/mlib/8169/06/8169_1244754206.jpg"><description xmlns="">Real, Genuine, Authentic, Classic Country</description></station></MoreStations></BottomPanel><FeaturedStations xmlns=""><station xmlns="" site_id="1793" stream_id="1469" name="WHTZ-FM" title="Z100" init="1" station_url="http://www.z100.com" domain="whtz-fm" genre="Hits" station_tagline="Z100" image="http://www.kfiam640.com/cc-common/mlib/1793/06/1793_1308063869.jpg" logo="http://www.kfiam640.com/cc-common/mlib/1793/11/1793_1290010748.jpg" city="New York" state="NY" site_format_id="658" description="New York's Hit Music Station" latitude="40.748333" longitude="-73.986115"></station><station xmlns="" site_id="842" stream_id="185" name="KIIS-FM" title="102.7 KIIS FM" init="1" station_url="http://www.kiisfm.com" domain="kiis-fm" genre="Hits" station_tagline="102.7 KIIS FM" image="http://www.kfiam640.com/cc-common/mlib/842/03/842_1300315912.jpg" logo="http://www.kfiam640.com/cc-common/mlib/842/09/842_1189548003.jpg" city="Los Angeles" state="CA" site_format_id="658" description="L.A's #1 Hit Music Station" latitude="34.226665" longitude="-118.065834"></station><station xmlns="" site_id="1773" stream_id="841" name="WGCI-FM" title="107.5 WGCI-FM" init="1" station_url="http://www.wgci.com" domain="wgci-fm" genre="Hip Hop and R&amp;B" station_tagline="107.5 WGCI-FM" image="http://www.kfiam640.com/cc-common/mlib/1773/02/1773_1297198528.jpg" logo="http://www.kfiam640.com/cc-common/mlib/1773/07/1773_1248970606.png" city="Chicago" state="IL" site_format_id="726" description="Chicago's Hip-Hop and R&amp;B" latitude="41.878887" longitude="-87.635559"></station></FeaturedStations></ListenLiveInitialize><Media xmlns=""><OnAir xmlns=""><RJ xmlns="" name="Bill Handel" thumb="http://www.kfiam640.com/pages/rotator_images/handel_56sq.jpg" blog_url="http://www.kfiam640.com/pages/Handel2.html" start_time="5:00am" end_time="9:00am"></RJ></OnAir></Media></PlayerContent>
    

# mplayer -novideo 'rtmp://cp19771.live.edgefcs.net/live/Los_CA_KFI-AM_OR@s7652?auth=daEcYaldKa8bZc_bXatcddobca5dca8cXaT-bpxHD.-4q-LLYY6_1omFDov1LCqmzsyp&amp;aifp=1234&amp;CHANNELID=177&amp;CPROG=_&amp;MARKET=LOSANGELES-CA&amp;REQUESTOR=KFI-AM&amp;SERVER_NAME=p2.kfi-am.ccomrcdn.com&amp;SITE_ID=616&amp;STATION_ID=KFI-AM&amp;MNM=1&amp;TYPEOFPLAY=0" backup_location=""'

mplayer -novideo 'rtmp://cp19771.live.edgefcs.net/live/Los_CA_KFI-AM_OR@s7652?auth=daEcYaldKa8bZc_bXatcddobca5dca8cXaT-bpxHD.-4q-LLYY6_1omFDov1LCqmzsyp&amp;aifp=1234&amp;CHANNELID=177&amp;CPROG=_&amp;MARKET=LOSANGELES-CA&amp;REQUESTOR=KFI-AM&amp;SERVER_NAME=p2.kfi-am.ccomrcdn.com&amp;SITE_ID=616&amp;STATION_ID=KFI-AM&amp;MNM=1&amp;TYPEOFPLAY=0" backup_location=""'

